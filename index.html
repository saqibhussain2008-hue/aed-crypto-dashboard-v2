<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.1">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #36c0a0; -webkit-text-stroke: #36c0a0}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s7 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s8 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s9 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s10 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s11 {font-kerning: none; color: #6d7378; background-color: #171818; -webkit-text-stroke: 0px #6d7378}
    span.s12 {font-kerning: none}
    span.s13 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s14 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"en"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">AED Crypto Predictive Dashboard</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Tailwind CSS CDN for styling and responsiveness --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Custom font and layout basics */</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">@import</span><span class="s4"> </span><span class="s5">url</span><span class="s8">(</span><span class="s1">'https://fonts.googleapis.com/css2?family=Inter:wght@100..900&amp;display=swap'</span><span class="s8">);</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">font-family:</span><span class="s4"> </span><span class="s9">'Inter'</span><span class="s8">,</span><span class="s4"> </span><span class="s5">sans-serif</span><span class="s8">;</span><span class="s4"> </span><span class="s1">background-color:</span><span class="s4"> #0d1117</span><span class="s8">;</span><span class="s4"> </span><span class="s1">color:</span><span class="s4"> #c9d1d9</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.card</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">background-color:</span><span class="s1"> #161b22</span><span class="s8">;</span><span class="s1"> </span><span class="s2">border:</span><span class="s1"> </span><span class="s10">1px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #30363d</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Updated colors for better icon visibility */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.signal-buy</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">background-color:</span><span class="s1"> #1e3a8a</span><span class="s8">;</span><span class="s1"> </span><span class="s2">color:</span><span class="s1"> #bfdbfe</span><span class="s8">;</span><span class="s1"> </span><span class="s2">border-color:</span><span class="s1"> #3b82f6</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.signal-sell</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">background-color:</span><span class="s1"> #6d1010</span><span class="s8">;</span><span class="s1"> </span><span class="s2">color:</span><span class="s1"> #fecaca</span><span class="s8">;</span><span class="s1"> </span><span class="s2">border-color:</span><span class="s1"> #ef4444</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.signal-hold</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">background-color:</span><span class="s1"> #3f3f46</span><span class="s8">;</span><span class="s1"> </span><span class="s2">color:</span><span class="s1"> #d4d4d8</span><span class="s8">;</span><span class="s1"> </span><span class="s2">border-color:</span><span class="s1"> #a1a1aa</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.p-profit</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">color:</span><span class="s1"> #10b981</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s11">/* Emerald 500 */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.p-loss</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">color:</span><span class="s1"> #ef4444</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> <span class="Apple-converted-space">  </span></span><span class="s11">/* Red 500 */</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.loading-ring</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s10">4px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> </span><span class="s5">rgba(</span><span class="s10">255</span><span class="s8">,</span><span class="s1"> </span><span class="s10">255</span><span class="s8">,</span><span class="s1"> </span><span class="s10">255</span><span class="s8">,</span><span class="s1"> </span><span class="s10">0.1</span><span class="s5">)</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-left-color:</span><span class="s1"> #3b82f6</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">50%</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s10">24px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s10">24px</span><span class="s8">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s4"> </span><span class="s1">spin</span><span class="s4"> </span><span class="s10">1s</span><span class="s4"> </span><span class="s1">linear</span><span class="s4"> </span><span class="s1">infinite</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">@keyframes</span><span class="s1"> </span><span class="s5">spin</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s5">to</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">rotate(</span><span class="s10">360deg</span><span class="s5">)</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Lucide Icons for aesthetic value --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://unpkg.com/lucide@latest"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 md:p-8"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"loading-overlay"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col items-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"loading-ring mb-4"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-white text-lg"</span><span class="s3">&gt;</span><span class="s1">Initializing Dashboard and connecting to secure storage...</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">header</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-8 border-b border-gray-700 pb-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-3xl font-bold text-white flex items-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">data-lucide</span><span class="s3">=</span><span class="s1">"line-chart"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-7 h-7 mr-3 text-blue-400"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>Crypto Trading Signals Dashboard (AED)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm text-gray-400 mt-1"</span><span class="s3">&gt;</span><span class="s1">Real-time market overview and portfolio performance analysis.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center mt-3 text-sm"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-gray-500 mr-2"</span><span class="s3">&gt;</span><span class="s1">User ID:</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"user-id"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs font-mono bg-gray-700 py-1 px-2 rounded"</span><span class="s3">&gt;</span><span class="s4">Local Mode</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"api-status"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-sm mt-2 text-green-400 italic"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>✅ Connected to **Binance Public API** for real-time prices (60s update).</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">header</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Portfolio Summary Card --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"lg:col-span-1 card p-6 rounded-xl shadow-lg"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center mb-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">data-lucide</span><span class="s3">=</span><span class="s1">"wallet"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-6 h-6 mr-3 text-yellow-500"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xl font-semibold text-white"</span><span class="s3">&gt;</span><span class="s1">My Portfolio (AED)</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"space-y-3"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex justify-between items-center text-gray-400"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s1">Total Invested:</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"total-invested"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-white font-medium text-lg"</span><span class="s3">&gt;</span><span class="s4">0.00 AED</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex justify-between items-center border-t border-gray-700 pt-3"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-lg font-semibold"</span><span class="s3">&gt;</span><span class="s1">Total P/L:</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"total-pl"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg font-bold p-profit"</span><span class="s3">&gt;</span><span class="s4">0.00 AED</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex justify-between items-center text-sm"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-gray-400"</span><span class="s3">&gt;</span><span class="s1">P/L %:</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"total-pl-percent"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-profit"</span><span class="s3">&gt;</span><span class="s4">0.00%</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Portfolio Holdings Table Card --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"lg:col-span-2 card p-6 rounded-xl shadow-lg overflow-x-auto"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-semibold text-white mb-4 flex items-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">data-lucide</span><span class="s3">=</span><span class="s1">"list-ordered"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-6 h-6 mr-3 text-cyan-500"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>Current Holdings</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">table</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"min-w-full divide-y divide-gray-700"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">thead</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"bg-gray-800"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Coin</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Qty</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Avg. Cost (AED)</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Current Value (AED)</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">P/L (AED)</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">thead</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">tbody</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"holdings-body"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"divide-y divide-gray-700"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Holdings will be rendered here --&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">tbody</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">table</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"showTransactionModal()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>Record Transaction</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Market Overview Section --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-white mb-4 border-b border-gray-700 pb-2 flex items-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">data-lucide</span><span class="s3">=</span><span class="s1">"zap"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-5 h-5 mr-2 text-red-400"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>Live Market Prices &amp; Signals</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"market-grid"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-8"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Crypto cards will be rendered here --&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Transaction History Section (NEW) --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"card p-6 rounded-xl shadow-lg overflow-x-auto"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-semibold text-white mb-4 flex items-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">data-lucide</span><span class="s3">=</span><span class="s1">"history"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-6 h-6 mr-3 text-indigo-500"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>Transaction History (Last 10)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">table</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"min-w-full divide-y divide-gray-700"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">thead</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"bg-gray-800"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Time</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Asset</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Type</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Quantity</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-3 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Price/Coin (AED)</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">thead</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">tbody</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"history-body"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"divide-y divide-gray-700"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">tr</span><span class="s3">&gt;&lt;</span><span class="s6">td</span><span class="s1"> </span><span class="s2">colspan</span><span class="s3">=</span><span class="s5">"5"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-center py-4 text-gray-500"</span><span class="s3">&gt;</span><span class="s1">No transactions recorded yet.</span><span class="s3">&lt;/</span><span class="s6">td</span><span class="s3">&gt;&lt;/</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">tbody</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">table</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Transaction Modal (Custom Dialog) --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"transaction-modal"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"card w-full max-w-lg rounded-xl shadow-2xl p-6"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold mb-4 text-white"</span><span class="s3">&gt;</span><span class="s4">Record Transaction</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">form</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"transaction-form"</span><span class="s4"> </span><span class="s2">onsubmit</span><span class="s3">=</span><span class="s1">"event.preventDefault(); handleTransactionSubmit()"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"space-y-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"asset"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-medium text-gray-400 mb-1"</span><span class="s3">&gt;</span><span class="s4">Asset</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">select</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"asset"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-2 bg-gray-800 border border-gray-700 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-white"</span><span class="s4"> </span><span class="s2">required</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"BTC"</span><span class="s3">&gt;</span><span class="s1">Bitcoin (BTC)</span><span class="s3">&lt;/</span><span class="s6">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"ETH"</span><span class="s3">&gt;</span><span class="s1">Ethereum (ETH)</span><span class="s3">&lt;/</span><span class="s6">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"SOL"</span><span class="s3">&gt;</span><span class="s1">Solana (SOL)</span><span class="s3">&lt;/</span><span class="s6">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"BNB"</span><span class="s3">&gt;</span><span class="s1">Binance Coin (BNB)</span><span class="s3">&lt;/</span><span class="s6">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"CAKE"</span><span class="s3">&gt;</span><span class="s1">PancakeSwap (CAKE)</span><span class="s3">&lt;/</span><span class="s6">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">select</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"type"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-medium text-gray-400 mb-1"</span><span class="s3">&gt;</span><span class="s4">Type</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">select</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"type"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-2 bg-gray-800 border border-gray-700 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-white"</span><span class="s4"> </span><span class="s2">required</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"Buy"</span><span class="s3">&gt;</span><span class="s1">Buy</span><span class="s3">&lt;/</span><span class="s6">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"Sell"</span><span class="s3">&gt;</span><span class="s1">Sell</span><span class="s3">&lt;/</span><span class="s6">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">select</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"quantity"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-medium text-gray-400 mb-1"</span><span class="s3">&gt;</span><span class="s4">Quantity</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s4"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"any"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"quantity"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-2 bg-gray-800 border border-gray-700 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-white"</span><span class="s4"> </span><span class="s2">required</span><span class="s4"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0.00000001"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s1"> </span><span class="s2">for</span><span class="s3">=</span><span class="s5">"cost"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"block text-sm font-medium text-gray-400 mb-1"</span><span class="s3">&gt;</span><span class="s1">Cost / Price per Coin (AED)</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s4"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"any"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"cost"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-2 bg-gray-800 border border-gray-700 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-white"</span><span class="s4"> </span><span class="s2">required</span><span class="s4"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex justify-end space-x-3 mt-6"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"button"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"hideTransactionModal()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-4 py-2 text-gray-300 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200"</span><span class="s3">&gt;</span><span class="s4">Cancel</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"submit"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition duration-200"</span><span class="s3">&gt;</span><span class="s4">Save Transaction</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">form</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"tx-message"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-4 text-center text-sm hidden"</span><span class="s3">&gt;&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Firebase/Firestore Imports and Setup --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> initializeApp </span><span class="s8">}</span><span class="s4"> </span><span class="s7">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> getAuth</span><span class="s8">,</span><span class="s1"> signInAnonymously</span><span class="s8">,</span><span class="s1"> signInWithCustomToken</span><span class="s8">,</span><span class="s1"> onAuthStateChanged </span><span class="s8">}</span><span class="s1"> </span><span class="s7">from</span><span class="s1"> </span><span class="s9">"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> getFirestore</span><span class="s8">,</span><span class="s1"> doc</span><span class="s8">,</span><span class="s1"> setDoc</span><span class="s8">,</span><span class="s1"> onSnapshot</span><span class="s8">,</span><span class="s1"> collection</span><span class="s8">,</span><span class="s1"> query</span><span class="s8">,</span><span class="s1"> addDoc</span><span class="s8">,</span><span class="s1"> orderBy</span><span class="s8">,</span><span class="s1"> limit </span><span class="s8">}</span><span class="s1"> </span><span class="s7">from</span><span class="s1"> </span><span class="s9">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> setLogLevel </span><span class="s8">}</span><span class="s4"> </span><span class="s7">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// ====================================================================</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- 🔑 FIREBASE CONFIGURATION (NOW POPULATED WITH YOUR KEYS) 🔑 ---</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// ====================================================================</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s4"> appId </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'crypto-dashboard-app'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> firebaseConfig </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>apiKey</span><span class="s8">:</span><span class="s4"> </span><span class="s1">"AIzaSyAI3Pl5vgTJmeAC7cZFcBH2DAmkDWuBjEc"</span><span class="s8">,</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>authDomain</span><span class="s8">:</span><span class="s4"> </span><span class="s1">"crypto-dashboard-58a99.firebaseapp.com"</span><span class="s8">,</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>projectId</span><span class="s8">:</span><span class="s4"> </span><span class="s1">"crypto-dashboard-58a99"</span><span class="s8">,</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>storageBucket</span><span class="s8">:</span><span class="s4"> </span><span class="s1">"crypto-dashboard-58a99.firebasestorage.app"</span><span class="s8">,</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messagingSenderId</span><span class="s8">:</span><span class="s1"> </span><span class="s9">"1033795648349"</span><span class="s8">,</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>appId</span><span class="s8">:</span><span class="s4"> </span><span class="s1">"1:1033795648349:web:c965ff343a06a2cee3c6b4"</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> initialAuthToken </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Global Crypto Dashboard Class definition<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">class</span><span class="s4"> </span><span class="s1">CryptoDashboard</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">constructor</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// --- Configuration ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">API_KEY</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s9">""</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">USD_TO_AED</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s14">3.6725</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">CRYPTO_ASSETS</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s8">[</span><span class="s1">'BTC'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'ETH'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'SOL'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'BNB'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'CAKE'</span><span class="s8">];</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">BINANCE_SYMBOLS</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">CRYPTO_ASSETS</span><span class="s8">.</span><span class="s4">map</span><span class="s8">(</span><span class="s4">a </span><span class="s8">=&gt;</span><span class="s4"> a </span><span class="s8">+</span><span class="s4"> </span><span class="s9">'USDT'</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">API_URL</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s8">()</span><span class="s4"> </span><span class="s8">=&gt;</span><span class="s4"> </span><span class="s1">`https://api.binance.com/api/v3/ticker/24hr?symbols=</span><span class="s8">${</span><span class="s13">JSON</span><span class="s8">.</span><span class="s4">stringify</span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s13">BINANCE_SYMBOLS</span><span class="s8">)}</span><span class="s1">`</span><span class="s8">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// --- State Management ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">BASE_USD_PRICES</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s9">'BTC'</span><span class="s8">:</span><span class="s1"> </span><span class="s14">108000</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'ETH'</span><span class="s8">:</span><span class="s1"> </span><span class="s14">3800</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'SOL'</span><span class="s8">:</span><span class="s1"> </span><span class="s14">180</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'BNB'</span><span class="s8">:</span><span class="s1"> </span><span class="s14">600</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'CAKE'</span><span class="s8">:</span><span class="s1"> </span><span class="s14">3.5</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> investedAED</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s8">,</span><span class="s1"> holdings</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{}</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">transactions </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">livePrices </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s4">userId </span><span class="s8">=</span><span class="s4"> </span><span class="s9">'local_user_temp'</span><span class="s8">;</span><span class="s4"> </span><span class="s1">// Default for non-initialized state</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">isAuthReady </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">marketInterval </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">isSimulated </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Flags to track Firebase readiness</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s4">isFirebaseReady </span><span class="s8">=</span><span class="s4"> </span><span class="s7">true</span><span class="s8">;</span><span class="s4"> </span><span class="s1">// Set to true since config is provided</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Make methods globally accessible for HTML event handlers</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>window</span><span class="s8">.</span><span class="s1">showTransactionModal </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">showTransactionModal</span><span class="s8">.</span><span class="s1">bind</span><span class="s8">(</span><span class="s7">this</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>window</span><span class="s8">.</span><span class="s1">hideTransactionModal </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">hideTransactionModal</span><span class="s8">.</span><span class="s1">bind</span><span class="s8">(</span><span class="s7">this</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>window</span><span class="s8">.</span><span class="s1">handleTransactionSubmit </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">handleTransactionSubmit</span><span class="s8">.</span><span class="s1">bind</span><span class="s8">(</span><span class="s7">this</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>* Utility to parse the flat array response from Binance into a key-value map.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>parseBinanceData</span><span class="s8">(</span><span class="s1">data</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> parsed </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s13">Array</span><span class="s8">.</span><span class="s1">isArray</span><span class="s8">(</span><span class="s1">data</span><span class="s8">))</span><span class="s1"> </span><span class="s7">return</span><span class="s1"> parsed</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>data</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">item </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> asset </span><span class="s8">=</span><span class="s1"> item</span><span class="s8">.</span><span class="s7">symbol</span><span class="s8">.</span><span class="s1">replace</span><span class="s8">(</span><span class="s9">'USDT'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">''</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s13">CRYPTO_ASSETS</span><span class="s8">.</span><span class="s1">includes</span><span class="s8">(</span><span class="s1">asset</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>parsed</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>priceUSD</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">item</span><span class="s8">.</span><span class="s1">lastPrice</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>change24h</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">item</span><span class="s8">.</span><span class="s1">priceChangePercent</span><span class="s8">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1"> parsed</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// --- API UTILITIES ---</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>* Implements exponential backoff for fetching data from external APIs.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> robustFetch</span><span class="s8">(</span><span class="s1">url</span><span class="s8">,</span><span class="s1"> maxRetries </span><span class="s8">=</span><span class="s1"> </span><span class="s14">3</span><span class="s8">,</span><span class="s1"> delay </span><span class="s8">=</span><span class="s1"> </span><span class="s14">1000</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">for</span><span class="s1"> </span><span class="s8">(</span><span class="s7">let</span><span class="s1"> i </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span><span class="s1"> i </span><span class="s8">&lt;</span><span class="s1"> maxRetries</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">++)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> response </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> fetch</span><span class="s8">(</span><span class="s1">url</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">response</span><span class="s8">.</span><span class="s1">ok</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">throw</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Error</span><span class="s8">(</span><span class="s9">`HTTP error! status: </span><span class="s8">${</span><span class="s1">response</span><span class="s8">.</span><span class="s1">status</span><span class="s8">}</span><span class="s9">`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">return</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> response</span><span class="s8">.</span><span class="s1">json</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">i </span><span class="s8">===</span><span class="s1"> maxRetries </span><span class="s8">-</span><span class="s1"> </span><span class="s14">1</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Final API request failed:"</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">.</span><span class="s1">message</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">throw</span><span class="s1"> error</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Propagate the final error</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s1">// Wait for delay * 2^i milliseconds before retrying</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">await</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Promise</span><span class="s8">(</span><span class="s1">resolve </span><span class="s8">=&gt;</span><span class="s1"> setTimeout</span><span class="s8">(</span><span class="s1">resolve</span><span class="s8">,</span><span class="s1"> delay </span><span class="s8">*</span><span class="s1"> </span><span class="s8">(</span><span class="s14">2</span><span class="s1"> </span><span class="s8">**</span><span class="s1"> i</span><span class="s8">)));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// --- FIREBASE INITIALIZATION AND AUTH (Conditional for local use) ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> initAuth</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirebaseReady</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>onAuthStateChanged</span><span class="s8">(</span><span class="s1">window</span><span class="s8">.</span><span class="s1">auth</span><span class="s8">,</span><span class="s1"> </span><span class="s7">async</span><span class="s1"> </span><span class="s8">(</span><span class="s1">user</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">user</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">userId </span><span class="s8">=</span><span class="s1"> user</span><span class="s8">.</span><span class="s1">uid</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">const</span><span class="s1"> anonUser </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> signInAnonymously</span><span class="s8">(</span><span class="s1">window</span><span class="s8">.</span><span class="s1">auth</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">userId </span><span class="s8">=</span><span class="s1"> anonUser</span><span class="s8">.</span><span class="s1">user</span><span class="s8">.</span><span class="s1">uid</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Authentication failed:"</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">userId </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'auth-failed-'</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> crypto</span><span class="s8">.</span><span class="s1">randomUUID</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'user-id'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">userId</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">isAuthReady </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">setupFirestoreListeners</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Local mode fallback (shouldn't be hit now, but kept for safety)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'user-id'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'LOCAL MODE (NO DB)'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">isAuthReady </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showLocalModeWarning</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">CRYPTO_ASSETS</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">asset </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio</span><span class="s8">.</span><span class="s1">holdings</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> quantity</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s8">,</span><span class="s1"> avgCostAED</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">startMarketUpdates</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'loading-overlay'</span><span class="s8">).</span><span class="s1">style</span><span class="s8">.</span><span class="s1">opacity </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'0'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>setTimeout</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'loading-overlay'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">),</span><span class="s1"> </span><span class="s14">300</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>showLocalModeWarning</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> statusEl </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'api-status'</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>statusEl</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'⚠️ &lt;span class="text-yellow-400"&gt;Portfolio Storage OFFLINE.&lt;/span&gt; Prices are real-time from Binance.'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>statusEl</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'text-green-400'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>statusEl</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'text-yellow-400'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>getPortfolioDocRef</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">userId </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s4"> path </span><span class="s8">=</span><span class="s4"> </span><span class="s1">`/artifacts/</span><span class="s8">${</span><span class="s4">appId</span><span class="s8">}</span><span class="s1">/users/</span><span class="s8">${</span><span class="s7">this</span><span class="s8">.</span><span class="s4">userId</span><span class="s8">}</span><span class="s1">/crypto_portfolio/portfolio_summary`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1"> doc</span><span class="s8">(</span><span class="s1">window</span><span class="s8">.</span><span class="s1">db</span><span class="s8">,</span><span class="s1"> path</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>getTransactionsCollectionRef</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">userId </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1"> collection</span><span class="s8">(</span><span class="s1">window</span><span class="s8">.</span><span class="s1">db</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`/artifacts/</span><span class="s8">${</span><span class="s1">appId</span><span class="s8">}</span><span class="s9">/users/</span><span class="s8">${</span><span class="s7">this</span><span class="s8">.</span><span class="s1">userId</span><span class="s8">}</span><span class="s9">/crypto_transactions`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>setupFirestoreListeners</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isAuthReady </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 1. Portfolio Listener (for holdings and P/L summary)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> portfolioDocRef </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">getPortfolioDocRef</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">portfolioDocRef</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>onSnapshot</span><span class="s8">(</span><span class="s1">portfolioDocRef</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">docSnap</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">docSnap</span><span class="s8">.</span><span class="s1">exists</span><span class="s8">())</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio </span><span class="s8">=</span><span class="s1"> docSnap</span><span class="s8">.</span><span class="s1">data</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> investedAED</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s8">,</span><span class="s1"> holdings</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{}</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">CRYPTO_ASSETS</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">asset </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio</span><span class="s8">.</span><span class="s1">holdings</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> quantity</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s8">,</span><span class="s1"> avgCostAED</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>setDoc</span><span class="s8">(</span><span class="s1">portfolioDocRef</span><span class="s8">,</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> merge</span><span class="s8">:</span><span class="s1"> </span><span class="s7">true</span><span class="s1"> </span><span class="s8">}).</span><span class="s7">catch</span><span class="s8">(</span><span class="s1">e </span><span class="s8">=&gt;</span><span class="s1"> console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Error initializing portfolio:"</span><span class="s8">,</span><span class="s1"> e</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">renderPortfolio</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">},</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Firestore portfolio listener error:"</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 2. Transaction History Listener (NEW)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> transactionsCollectionRef </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">getTransactionsCollectionRef</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">transactionsCollectionRef</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> q </span><span class="s8">=</span><span class="s1"> query</span><span class="s8">(</span><span class="s1">transactionsCollectionRef</span><span class="s8">,</span><span class="s1"> orderBy</span><span class="s8">(</span><span class="s9">'timestamp'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'desc'</span><span class="s8">),</span><span class="s1"> limit</span><span class="s8">(</span><span class="s14">10</span><span class="s8">));</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>onSnapshot</span><span class="s8">(</span><span class="s1">q</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">snapshot</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">transactions </span><span class="s8">=</span><span class="s1"> snapshot</span><span class="s8">.</span><span class="s1">docs</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">doc </span><span class="s8">=&gt;</span><span class="s1"> doc</span><span class="s8">.</span><span class="s1">data</span><span class="s8">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">renderTransactionHistory</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">},</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Firestore transaction listener error:"</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// --- REAL-TIME DATA &amp; SIGNAL LOGIC ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>startMarketUpdates</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">fetchLivePrices</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">marketInterval</span><span class="s8">)</span><span class="s1"> clearInterval</span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">marketInterval</span><span class="s8">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Keep the update fast in case Binance fails, but use 60s for real data</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> interval </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">isSimulated </span><span class="s8">?</span><span class="s1"> </span><span class="s14">4000</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s14">60000</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">marketInterval </span><span class="s8">=</span><span class="s1"> setInterval</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">fetchLivePrices</span><span class="s8">(),</span><span class="s1"> interval</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> fetchLivePrices</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> newPrices </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> apiStatusElement </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'api-status'</span><span class="s8">);</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> url </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s13">API_URL</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> data </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">robustFetch</span><span class="s8">(</span><span class="s1">url</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> parsedData </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">parseBinanceData</span><span class="s8">(</span><span class="s1">data</span><span class="s8">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">CRYPTO_ASSETS</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">asset </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> marketData </span><span class="s8">=</span><span class="s1"> parsedData</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">marketData</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> priceUSD </span><span class="s8">=</span><span class="s1"> marketData</span><span class="s8">.</span><span class="s1">priceUSD</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> priceAED </span><span class="s8">=</span><span class="s1"> priceUSD </span><span class="s8">*</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s13">USD_TO_AED</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> change24h </span><span class="s8">=</span><span class="s1"> marketData</span><span class="s8">.</span><span class="s1">change24h</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>newPrices</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span>priceAED</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">priceAED</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">4</span><span class="s8">)),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span>change24h</span><span class="s8">:</span><span class="s1"> change24h</span><span class="s8">,</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                                </span>signal</span><span class="s8">:</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">calculateSignal</span><span class="s8">(</span><span class="s1">change24h</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">throw</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Error</span><span class="s8">(</span><span class="s9">`</span><span class="s8">${</span><span class="s1">asset</span><span class="s8">}</span><span class="s9"> not found in API response.`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">isSimulated </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span>apiStatusElement</span><span class="s8">.</span><span class="s4">textContent </span><span class="s8">=</span><span class="s4"> </span><span class="s1">"✅ Connected to **Binance Public API** for real-time prices (60s update)."</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s1">// Keep warning if local mode, but confirm Binance is working</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span>apiStatusElement</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'⚠️ &lt;span class="text-yellow-400"&gt;Portfolio Storage OFFLINE.&lt;/span&gt; Prices are real-time from Binance.'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>apiStatusElement</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'text-red-400'</span><span class="s8">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span>apiStatusElement</span><span class="s8">.</span><span class="s4">classList</span><span class="s8">.</span><span class="s4">add</span><span class="s8">(</span><span class="s9">'text-green-400'</span><span class="s8">,</span><span class="s4"> </span><span class="s9">'text-yellow-400'</span><span class="s8">);</span><span class="s4"> </span><span class="s1">// Use both to allow dynamic color change if error occurs</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span>console</span><span class="s8">.</span><span class="s4">error</span><span class="s8">(</span><span class="s1">"Failed to fetch real data, switching to simulation:"</span><span class="s8">,</span><span class="s4"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">isSimulated </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span>apiStatusElement</span><span class="s8">.</span><span class="s4">textContent </span><span class="s8">=</span><span class="s4"> </span><span class="s1">"⚠️ Binance API failed. Dashboard is using **simulated prices** (4s update)."</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>apiStatusElement</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'text-green-400'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'text-yellow-400'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>apiStatusElement</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'text-red-400'</span><span class="s8">);</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Fallback to simulation if API fails</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">CRYPTO_ASSETS</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">asset </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> baseUSD </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s13">BASE_USD_PRICES</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> fluctuation </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s13">Math</span><span class="s8">.</span><span class="s1">random</span><span class="s8">()</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s14">0.04</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> </span><span class="s14">0.02</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> baseUSD</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> priceUSD </span><span class="s8">=</span><span class="s1"> baseUSD </span><span class="s8">+</span><span class="s1"> fluctuation</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> priceAED </span><span class="s8">=</span><span class="s1"> priceUSD </span><span class="s8">*</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s13">USD_TO_AED</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> simulatedChange24h </span><span class="s8">=</span><span class="s1"> parseFloat</span><span class="s8">((</span><span class="s13">Math</span><span class="s8">.</span><span class="s1">random</span><span class="s8">()</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s14">8</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> </span><span class="s14">4</span><span class="s8">).</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">));</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>newPrices</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>priceAED</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">priceAED</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">4</span><span class="s8">)),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>change24h</span><span class="s8">:</span><span class="s1"> simulatedChange24h</span><span class="s8">,</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>signal</span><span class="s8">:</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">calculateSignal</span><span class="s8">(</span><span class="s1">simulatedChange24h</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">livePrices </span><span class="s8">=</span><span class="s1"> newPrices</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">renderDashboard</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>* SIGNAL LOGIC: Based on 24-hour price change momentum.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>calculateSignal</span><span class="s8">(</span><span class="s1">change24h</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">change24h </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s8">-</span><span class="s14">3.0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> type</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Buy'</span><span class="s8">,</span><span class="s4"> text</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Momentum Buy (Recent Drop &gt; 3.0%)'</span><span class="s4"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">change24h </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s14">4.0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> type</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Sell'</span><span class="s8">,</span><span class="s4"> text</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Momentum Sell (Recent Gain &gt; 4.0%)'</span><span class="s4"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> type</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Hold'</span><span class="s8">,</span><span class="s4"> text</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Neutral (Momentum within bounds)'</span><span class="s4"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// --- RENDERING FUNCTIONS ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>renderDashboard</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">renderMarketGrid</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">renderPortfolio</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">renderTransactionHistory</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>lucide</span><span class="s8">.</span><span class="s1">createIcons</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>renderMarketGrid</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> grid </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'market-grid'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>grid</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s13">CRYPTO_ASSETS</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">asset </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> data </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">livePrices</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> priceAED </span><span class="s8">=</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">priceAED </span><span class="s8">?</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">priceAED</span><span class="s8">.</span><span class="s1">toLocaleString</span><span class="s8">(</span><span class="s9">'en-US'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> minimumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s8">,</span><span class="s1"> maximumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s1"> </span><span class="s8">})</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'...'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> changeClass </span><span class="s8">=</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">change24h </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'text-green-400'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'text-red-400'</span><span class="s8">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> signalType </span><span class="s8">=</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">signal</span><span class="s8">?.</span><span class="s1">type </span><span class="s8">||</span><span class="s1"> </span><span class="s9">'Hold'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> signalClass </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`signal-</span><span class="s8">${</span><span class="s1">signalType</span><span class="s8">.</span><span class="s1">toLowerCase</span><span class="s8">()}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">let</span><span class="s1"> iconName </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'pause-circle'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">let</span><span class="s1"> iconColor </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'text-gray-200'</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">signalType </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'Buy'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>iconName </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'arrow-up-circle'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>iconColor </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'text-blue-200'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">signalType </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'Sell'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>iconName </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'arrow-down-circle'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>iconColor </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'text-red-200'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> signalIcon </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`&lt;i data-lucide="</span><span class="s8">${</span><span class="s1">iconName</span><span class="s8">}</span><span class="s9">" class="w-4 h-4 mr-1 </span><span class="s8">${</span><span class="s1">iconColor</span><span class="s8">}</span><span class="s9">"&gt;&lt;/i&gt;`</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="card p-5 rounded-xl shadow-md transition-all duration-300 hover:shadow-xl hover:ring-2 hover:ring-blue-500"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex justify-between items-center mb-3"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;h3 class="text-xl font-bold text-white"&gt;</span><span class="s8">${</span><span class="s4">asset</span><span class="s8">}</span><span class="s1">&lt;/h3&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;div class="text-xs font-mono py-1 px-2 rounded-full </span><span class="s8">${</span><span class="s4">signalClass</span><span class="s8">}</span><span class="s1"> shadow-md flex items-center"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s8">${</span><span class="s4">signalIcon</span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s8">${</span><span class="s4">signalType</span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="mb-4"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;p class="text-3xl font-extrabold text-white"&gt;</span><span class="s8">${</span><span class="s4">priceAED</span><span class="s8">}</span><span class="s1"> &lt;span class="text-base font-normal text-gray-400"&gt;AED&lt;/span&gt;&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;p class="text-sm </span><span class="s8">${</span><span class="s4">changeClass</span><span class="s8">}</span><span class="s1"> mt-1"&gt;24h Change: </span><span class="s8">${</span><span class="s4">data</span><span class="s8">.</span><span class="s4">change24h </span><span class="s8">!==</span><span class="s4"> </span><span class="s7">undefined</span><span class="s4"> </span><span class="s8">?</span><span class="s4"> data</span><span class="s8">.</span><span class="s4">change24h</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">'0.00'</span><span class="s8">}</span><span class="s1">%&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-xs text-gray-500 italic"&gt;</span><span class="s8">${</span><span class="s4">data</span><span class="s8">.</span><span class="s4">signal</span><span class="s8">?.</span><span class="s4">text </span><span class="s8">||</span><span class="s4"> </span><span class="s1">'Fetching signal...'</span><span class="s8">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">''</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>renderPortfolio</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> totalInvested </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> currentValue </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> holdingsBody </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'holdings-body'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>holdingsBody</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Check if we have portfolio data or if we're in offline mode</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-invested'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'--- AED'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-pl'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'--- AED'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-pl-percent'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'--- %'</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                     </span>holdingsBody</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'&lt;tr&gt;&lt;td colspan="5" class="text-center py-4 text-gray-500"&gt;Portfolio features disabled in local mode.&lt;/td&gt;&lt;/tr&gt;'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s13">CRYPTO_ASSETS</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">asset </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> holding </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio</span><span class="s8">.</span><span class="s1">holdings</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> quantity</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s8">,</span><span class="s1"> avgCostAED</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> livePriceAED </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">livePrices</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]?.</span><span class="s1">priceAED </span><span class="s8">||</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">holding</span><span class="s8">.</span><span class="s1">quantity </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s14">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> costBasis </span><span class="s8">=</span><span class="s1"> holding</span><span class="s8">.</span><span class="s1">quantity </span><span class="s8">*</span><span class="s1"> holding</span><span class="s8">.</span><span class="s1">avgCostAED</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> marketValue </span><span class="s8">=</span><span class="s1"> holding</span><span class="s8">.</span><span class="s1">quantity </span><span class="s8">*</span><span class="s1"> livePriceAED</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> profitLoss </span><span class="s8">=</span><span class="s1"> marketValue </span><span class="s8">-</span><span class="s1"> costBasis</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> profitLossPercent </span><span class="s8">=</span><span class="s1"> costBasis </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s8">(</span><span class="s1">profitLoss </span><span class="s8">/</span><span class="s1"> costBasis</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s14">100</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>totalInvested </span><span class="s8">+=</span><span class="s1"> costBasis</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>currentValue </span><span class="s8">+=</span><span class="s1"> marketValue</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> plClass </span><span class="s8">=</span><span class="s1"> profitLoss </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'p-profit'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'p-loss'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> plSign </span><span class="s8">=</span><span class="s1"> profitLoss </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'+'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> row </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;tr class="hover:bg-gray-800 transition duration-150"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-3 font-semibold text-white"&gt;</span><span class="s8">${</span><span class="s4">asset</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-3 text-gray-300"&gt;</span><span class="s8">${</span><span class="s4">holding</span><span class="s8">.</span><span class="s4">quantity</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s14">8</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-3 text-right text-gray-300"&gt;</span><span class="s8">${</span><span class="s4">holding</span><span class="s8">.</span><span class="s4">avgCostAED</span><span class="s8">.</span><span class="s4">toLocaleString</span><span class="s8">(</span><span class="s1">'en-US'</span><span class="s8">,</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> minimumFractionDigits</span><span class="s8">:</span><span class="s4"> </span><span class="s14">2</span><span class="s8">,</span><span class="s4"> maximumFractionDigits</span><span class="s8">:</span><span class="s4"> </span><span class="s14">2</span><span class="s4"> </span><span class="s8">})}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-3 text-right text-white font-medium"&gt;</span><span class="s8">${</span><span class="s4">marketValue</span><span class="s8">.</span><span class="s4">toLocaleString</span><span class="s8">(</span><span class="s1">'en-US'</span><span class="s8">,</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> minimumFractionDigits</span><span class="s8">:</span><span class="s4"> </span><span class="s14">2</span><span class="s8">,</span><span class="s4"> maximumFractionDigits</span><span class="s8">:</span><span class="s4"> </span><span class="s14">2</span><span class="s4"> </span><span class="s8">})}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-3 text-right </span><span class="s8">${</span><span class="s4">plClass</span><span class="s8">}</span><span class="s1">"&gt;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">                                    </span></span><span class="s8">${</span><span class="s1">plSign</span><span class="s8">}${</span><span class="s1">profitLoss</span><span class="s8">.</span><span class="s1">toLocaleString</span><span class="s8">(</span><span class="s9">'en-US'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> minimumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s8">,</span><span class="s1"> maximumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s1"> </span><span class="s8">})}</span><span class="s9"> (</span><span class="s8">${</span><span class="s1">profitLossPercent</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)}</span><span class="s9">%)</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/tr&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>holdingsBody</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">+=</span><span class="s1"> row</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> totalPL </span><span class="s8">=</span><span class="s1"> currentValue </span><span class="s8">-</span><span class="s1"> totalInvested</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> totalPLPercent </span><span class="s8">=</span><span class="s1"> totalInvested </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s8">(</span><span class="s1">totalPL </span><span class="s8">/</span><span class="s1"> totalInvested</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s14">100</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> plClassTotal </span><span class="s8">=</span><span class="s1"> totalPL </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'p-profit'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'p-loss'</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-invested'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> totalInvested</span><span class="s8">.</span><span class="s1">toLocaleString</span><span class="s8">(</span><span class="s9">'en-US'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> minimumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s8">,</span><span class="s1"> maximumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s1"> </span><span class="s8">})</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s9">' AED'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-pl'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">totalPL </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'+'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">''</span><span class="s8">)</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> totalPL</span><span class="s8">.</span><span class="s1">toLocaleString</span><span class="s8">(</span><span class="s9">'en-US'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> minimumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s8">,</span><span class="s1"> maximumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s1"> </span><span class="s8">})</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s9">' AED'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-pl'</span><span class="s8">).</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`text-lg font-bold </span><span class="s8">${</span><span class="s1">plClassTotal</span><span class="s8">}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-pl-percent'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> totalPLPercent</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">2</span><span class="s8">)</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s9">'%'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'total-pl-percent'</span><span class="s8">).</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> plClassTotal</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// NEW: Renders the transaction history table</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>renderTransactionHistory</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> historyBody </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'history-body'</span><span class="s8">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected </span><span class="s8">||</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">transactions</span><span class="s8">.</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s14">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span>historyBody</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'&lt;tr&gt;&lt;td colspan="5" class="text-center py-4 text-gray-500"&gt;History unavailable in local mode.&lt;/td&gt;&lt;/tr&gt;'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>historyBody</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">transactions</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">tx </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> date </span><span class="s8">=</span><span class="s1"> tx</span><span class="s8">.</span><span class="s1">timestamp </span><span class="s8">?</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Date</span><span class="s8">(</span><span class="s1">tx</span><span class="s8">.</span><span class="s1">timestamp</span><span class="s8">).</span><span class="s1">toLocaleString</span><span class="s8">()</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'N/A'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> typeClass </span><span class="s8">=</span><span class="s1"> tx</span><span class="s8">.</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'Buy'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'text-green-400'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'text-red-400'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> priceFormatted </span><span class="s8">=</span><span class="s1"> tx</span><span class="s8">.</span><span class="s1">costPerUnit</span><span class="s8">.</span><span class="s1">toLocaleString</span><span class="s8">(</span><span class="s9">'en-US'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> minimumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s8">,</span><span class="s1"> maximumFractionDigits</span><span class="s8">:</span><span class="s1"> </span><span class="s14">2</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;tr class="hover:bg-gray-800 transition duration-150"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td class="px-3 py-2 text-xs text-gray-400"&gt;</span><span class="s8">${</span><span class="s4">date</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td class="px-3 py-2 font-semibold text-white"&gt;</span><span class="s8">${</span><span class="s4">tx</span><span class="s8">.</span><span class="s4">asset</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td class="px-3 py-2 font-bold </span><span class="s8">${</span><span class="s4">typeClass</span><span class="s8">}</span><span class="s1">"&gt;</span><span class="s8">${</span><span class="s4">tx</span><span class="s8">.</span><span class="s4">type</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td class="px-3 py-2 text-right text-gray-300"&gt;</span><span class="s8">${</span><span class="s4">tx</span><span class="s8">.</span><span class="s4">quantity</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s14">8</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td class="px-3 py-2 text-right text-gray-300"&gt;</span><span class="s8">${</span><span class="s4">priceFormatted</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/tr&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">''</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// --- TRANSACTION LOGIC (UPDATED) ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>showTransactionModal</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                     </span></span><span class="s7">this</span><span class="s8">.</span><span class="s4">showTxMessage</span><span class="s8">(</span><span class="s1">"Portfolio tracking is disabled. Please configure Firebase to save transactions."</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'text-yellow-500'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'transaction-modal'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'tx-message'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>hideTransactionModal</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'transaction-modal'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'transaction-form'</span><span class="s8">).</span><span class="s1">reset</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> handleTransactionSubmit</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">isFirestoreConnected</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s4">showTxMessage</span><span class="s8">(</span><span class="s1">"Cannot save. Portfolio storage is OFFLINE."</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'text-red-500'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> form </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'transaction-form'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> asset </span><span class="s8">=</span><span class="s1"> form</span><span class="s8">.</span><span class="s1">asset</span><span class="s8">.</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> type </span><span class="s8">=</span><span class="s1"> form</span><span class="s8">.</span><span class="s1">type</span><span class="s8">.</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> quantity </span><span class="s8">=</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">form</span><span class="s8">.</span><span class="s1">quantity</span><span class="s8">.</span><span class="s1">value</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> costPerUnit </span><span class="s8">=</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">form</span><span class="s8">.</span><span class="s1">cost</span><span class="s8">.</span><span class="s1">value</span><span class="s8">);</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isNaN</span><span class="s8">(</span><span class="s1">quantity</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> quantity </span><span class="s8">&lt;=</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> isNaN</span><span class="s8">(</span><span class="s1">costPerUnit</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> costPerUnit </span><span class="s8">&lt;=</span><span class="s1"> </span><span class="s14">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s4">showTxMessage</span><span class="s8">(</span><span class="s1">"Please enter valid positive numbers for quantity and cost."</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'text-red-500'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> currentHolding </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio</span><span class="s8">.</span><span class="s1">holdings</span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> quantity</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s8">,</span><span class="s1"> avgCostAED</span><span class="s8">:</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> newQuantity</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> newAvgCostAED</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> investedChange </span><span class="s8">=</span><span class="s1"> </span><span class="s14">0</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'Buy'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> totalCost </span><span class="s8">=</span><span class="s1"> quantity </span><span class="s8">*</span><span class="s1"> costPerUnit</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> oldTotalCost </span><span class="s8">=</span><span class="s1"> currentHolding</span><span class="s8">.</span><span class="s1">quantity </span><span class="s8">*</span><span class="s1"> currentHolding</span><span class="s8">.</span><span class="s1">avgCostAED</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>newQuantity </span><span class="s8">=</span><span class="s1"> currentHolding</span><span class="s8">.</span><span class="s1">quantity </span><span class="s8">+</span><span class="s1"> quantity</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>newAvgCostAED </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">oldTotalCost </span><span class="s8">+</span><span class="s1"> totalCost</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> newQuantity</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>investedChange </span><span class="s8">=</span><span class="s1"> totalCost</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'Sell'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">quantity </span><span class="s8">&gt;</span><span class="s1"> currentHolding</span><span class="s8">.</span><span class="s1">quantity</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showTxMessage</span><span class="s8">(</span><span class="s9">`Cannot sell </span><span class="s8">${</span><span class="s1">quantity</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">8</span><span class="s8">)}</span><span class="s9"> of </span><span class="s8">${</span><span class="s1">asset</span><span class="s8">}</span><span class="s9">. You only hold </span><span class="s8">${</span><span class="s1">currentHolding</span><span class="s8">.</span><span class="s1">quantity</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s14">8</span><span class="s8">)}</span><span class="s9">.`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'text-red-500'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>newQuantity </span><span class="s8">=</span><span class="s1"> currentHolding</span><span class="s8">.</span><span class="s1">quantity </span><span class="s8">-</span><span class="s1"> quantity</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>newAvgCostAED </span><span class="s8">=</span><span class="s1"> newQuantity </span><span class="s8">===</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s14">0</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> currentHolding</span><span class="s8">.</span><span class="s1">avgCostAED</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>investedChange </span><span class="s8">=</span><span class="s1"> </span><span class="s8">-(</span><span class="s1">quantity </span><span class="s8">*</span><span class="s1"> currentHolding</span><span class="s8">.</span><span class="s1">avgCostAED</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 1. Prepare Portfolio Update</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> updatedPortfolio </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">...</span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>investedAED</span><span class="s8">:</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio</span><span class="s8">.</span><span class="s1">investedAED </span><span class="s8">+</span><span class="s1"> investedChange</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>holdings</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">...</span><span class="s7">this</span><span class="s8">.</span><span class="s1">portfolio</span><span class="s8">.</span><span class="s1">holdings</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">[</span><span class="s1">asset</span><span class="s8">]:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>quantity</span><span class="s8">:</span><span class="s1"> newQuantity</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>avgCostAED</span><span class="s8">:</span><span class="s1"> newAvgCostAED</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">};</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 2. Prepare Transaction Record (for history table)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> newTransaction </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>asset</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>type</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>quantity</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>costPerUnit</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>timestamp</span><span class="s8">:</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Date</span><span class="s8">().</span><span class="s1">toISOString</span><span class="s8">(),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>totalCost</span><span class="s8">:</span><span class="s1"> quantity </span><span class="s8">*</span><span class="s1"> costPerUnit</span><span class="s8">,</span><span class="s1"> </span><span class="s11">// Total AED for this specific transaction</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">};</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Save to Firestore</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> portfolioDocRef </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">getPortfolioDocRef</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> setDoc</span><span class="s8">(</span><span class="s1">portfolioDocRef</span><span class="s8">,</span><span class="s1"> updatedPortfolio</span><span class="s8">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> transactionsCollectionRef </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">getTransactionsCollectionRef</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> addDoc</span><span class="s8">(</span><span class="s1">transactionsCollectionRef</span><span class="s8">,</span><span class="s1"> newTransaction</span><span class="s8">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s4">showTxMessage</span><span class="s8">(</span><span class="s1">'Transaction recorded successfully and portfolio updated!'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'text-green-500'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>setTimeout</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">hideTransactionModal</span><span class="s8">(),</span><span class="s1"> </span><span class="s14">1500</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Error saving transaction:"</span><span class="s8">,</span><span class="s1"> e</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showTxMessage</span><span class="s8">(</span><span class="s9">'Error saving transaction: '</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">message</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'text-red-500'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>showTxMessage</span><span class="s8">(</span><span class="s1">message</span><span class="s8">,</span><span class="s1"> colorClass</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> msgEl </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'tx-message'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>msgEl</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> message</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>msgEl</span><span class="s8">.</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`mt-4 text-center text-sm </span><span class="s8">${</span><span class="s1">colorClass</span><span class="s8">}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>msgEl</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- INITIALIZATION LOGIC ---</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> shouldInitializeFirebase </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Check if Firebase keys are actual keys (meaning the user updated them for GitHub/Public deployment)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">firebaseConfig</span><span class="s8">.</span><span class="s1">apiKey </span><span class="s8">&amp;&amp;</span><span class="s1"> firebaseConfig</span><span class="s8">.</span><span class="s1">apiKey </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">"YOUR_FIREBASE_API_KEY_HERE"</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">             </span>shouldInitializeFirebase </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> cryptoApp </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s13">CryptoDashboard</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">cryptoApp </span><span class="s8">=</span><span class="s1"> cryptoApp</span><span class="s8">;</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">shouldInitializeFirebase</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// User has provided a valid key, proceed with full DB setup (for GitHub deployment)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>setLogLevel</span><span class="s8">(</span><span class="s9">'Debug'</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> app </span><span class="s8">=</span><span class="s1"> initializeApp</span><span class="s8">(</span><span class="s1">firebaseConfig</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>window</span><span class="s8">.</span><span class="s1">db </span><span class="s8">=</span><span class="s1"> getFirestore</span><span class="s8">(</span><span class="s1">app</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>window</span><span class="s8">.</span><span class="s1">auth </span><span class="s8">=</span><span class="s1"> getAuth</span><span class="s8">(</span><span class="s1">app</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>cryptoApp</span><span class="s8">.</span><span class="s1">isFirebaseReady </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>cryptoApp</span><span class="s8">.</span><span class="s1">initAuth</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Running in local mode without DB setup (prices/signals work, portfolio does not)</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>cryptoApp</span><span class="s8">.</span><span class="s4">initAuth</span><span class="s8">();</span><span class="s4"> </span><span class="s1">// Still calls initAuth for price fetching and local rendering</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>console</span><span class="s8">.</span><span class="s4">warn</span><span class="s8">(</span><span class="s1">"Running in local mode. Portfolio tracking is disabled. Update Firebase keys for persistence."</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p7"><span class="s12"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Render Lucide icons when the page loads</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'DOMContentLoaded'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>lucide</span><span class="s8">.</span><span class="s1">createIcons</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">});</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s12"></span><br></p>
</body>
</html>
